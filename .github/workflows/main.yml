name: auto_update

on:
  schedule:
    - cron: "30 1,10 * * *"
  workflow_dispatch:
  repository_dispatch:
    types: [update_profile]
    
jobs:
  generate:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v2
      - name: 'Set up Python'
        uses: actions/setup-python@v1
        with:
          python-version: 3.7
        
      - name: 'Working'
        run: |
          pip3 install feedparser 
          python3 main.py
        
      - name: Commit and push if changed
        env:
          TARGET_REPO_TOKEN: ${{ secrets.TARGET_REPO_TOKEN }}
        run: |
          git diff
          git config --global user.email 734962820@qq.com
          git config --global user.name yujianke100
          git add README.md
          git commit -m "Github Action Auto Updated"
          git push
          
      - name: Trigger Another Workflow
      - uses: actions/checkout@v2
      - uses: gautamkrishnar/blog-post-workflow@master
        with:
          feed_list: "https://github.com/yujianke100/yujianke100.github.io/.github/workflows/google_scholar_crawler.yaml"
          max_post_count: 10

